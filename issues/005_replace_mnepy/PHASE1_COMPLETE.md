# Phase 1 å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**å®Œäº†æ—¥**: 2025-11-11
**Phase**: 1 - å‰å‡¦ç†å¼·åŒ–

---

## âœ… å®Ÿè£…å†…å®¹

### 1. ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã®æ˜ç¤ºåŒ–

**å¤‰æ›´å‰**:
```python
# ãƒã‚¤ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã®ã¿ï¼ˆ1Hzä»¥ä¸Šï¼‰
raw = raw.filter(l_freq=1.0, h_freq=None, fir_design='firwin', verbose=False)
```

**å¤‰æ›´å¾Œ**:
```python
# ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆ1-50Hzã€Museã®æœ‰åŠ¹å¸¯åŸŸï¼‰
if apply_bandpass:
    raw = raw.filter(l_freq=l_freq, h_freq=h_freq,
                   fir_design='firwin', verbose=False)
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- Museã®æœ‰åŠ¹å‘¨æ³¢æ•°å¸¯åŸŸï¼ˆ1-50Hzï¼‰ã‚’æ˜ç¤ºçš„ã«è¨­å®š
- é«˜å‘¨æ³¢ãƒã‚¤ã‚ºï¼ˆ>50Hzï¼‰ã‚’é™¤å»
- è§£æå¯¾è±¡å¸¯åŸŸãŒæ˜ç¢ºåŒ–

---

### 2. ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ã®è¿½åŠ 

**æ–°è¦å®Ÿè£…**:
```python
# é›»æºãƒã‚¤ã‚ºé™¤å»ï¼ˆ50Hz, 60Hzï¼‰
if apply_notch and notch_freqs:
    raw = raw.notch_filter(freqs=notch_freqs, verbose=False)
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- 50Hzï¼ˆæ—¥æœ¬ãƒ»ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ï¼‰ã¨60Hzï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰ã®é›»æºãƒã‚¤ã‚ºã‚’é™¤å»
- ç‹­å¸¯åŸŸé™¤å»ã«ã‚ˆã‚Šã€å‘¨è¾ºå‘¨æ³¢æ•°ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ–
- muse-lslã®å®Ÿè£…ã‚’å‚è€ƒã«ã—ãŸæ¨™æº–çš„ãªæ‰‹æ³•

---

## ğŸ“ å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«

### `lib/sensors/eeg/preprocessing.py`

#### é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ã®æ›´æ–°

**å¤‰æ›´å‰**:
```python
def prepare_mne_raw(df, sfreq=None):
```

**å¤‰æ›´å¾Œ**:
```python
def prepare_mne_raw(df, sfreq=None, apply_bandpass=True, apply_notch=True,
                    l_freq=1.0, h_freq=50.0, notch_freqs=(50, 60)):
```

**æ–°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `apply_bandpass`: ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Trueï¼‰
- `apply_notch`: ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Trueï¼‰
- `l_freq`: ä¸‹é™å‘¨æ³¢æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1.0Hzï¼‰
- `h_freq`: ä¸Šé™å‘¨æ³¢æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50.0Hzï¼‰
- `notch_freqs`: ãƒãƒƒãƒå‘¨æ³¢æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: (50, 60)Hzï¼‰

---

## ğŸ”§ ãƒ•ã‚£ãƒ«ã‚¿ã®é©ç”¨é †åº

```
ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆRAW EEGï¼‰
    â†“
1. ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ (1-50Hz)
   - DCãƒ‰ãƒªãƒ•ãƒˆé™¤å»ï¼ˆ<1Hzï¼‰
   - é«˜å‘¨æ³¢ãƒã‚¤ã‚ºé™¤å»ï¼ˆ>50Hzï¼‰
    â†“
2. ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ (50Hz, 60Hz)
   - é›»æºãƒã‚¤ã‚ºã®ç‹­å¸¯åŸŸé™¤å»
    â†“
ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿EEG
```

---

## ğŸ¯ å¾Œæ–¹äº’æ›æ€§

âœ… **å®Œå…¨ãªå¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ**

æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦ï¼š
```python
# æ—¢å­˜ã®å‘¼ã³å‡ºã—ï¼ˆå¤‰æ›´ãªã—ï¼‰
mne_dict = prepare_mne_raw(df)

# æ–°ã—ã„å‘¼ã³å‡ºã—ä¾‹
mne_dict = prepare_mne_raw(df, apply_bandpass=True, apply_notch=True)

# ãƒ•ã‚£ãƒ«ã‚¿ã‚’ç„¡åŠ¹åŒ–
mne_dict = prepare_mne_raw(df, apply_bandpass=False, apply_notch=False)

# ã‚«ã‚¹ã‚¿ãƒ è¨­å®š
mne_dict = prepare_mne_raw(df, l_freq=0.5, h_freq=40.0, notch_freqs=(60,))
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### muse-lsl

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tmp/muse-lsl/examples/utils.py:158-176`

```python
NOTCH_B, NOTCH_A = butter(4, np.array([55, 65]) / (256 / 2), btype='bandstop')

def update_buffer(data_buffer, new_data, notch=False, filter_state=None):
    if notch:
        new_data, filter_state = lfilter(NOTCH_B, NOTCH_A, new_data,
                                         axis=0, zi=filter_state)
```

- muse-lslã§ã¯55-65Hzã®ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ï¼ˆ60Hzä¸­å¿ƒï¼‰
- æˆ‘ã€…ã¯50Hz, 60Hzã®ä¸¡æ–¹ã«å¯¾å¿œï¼ˆã‚ˆã‚Šæ±ç”¨çš„ï¼‰

### MNE-Python

- [Filtering and resampling tutorial](https://mne.tools/stable/auto_tutorials/preprocessing/30_filtering_resampling.html)
- [raw.filter() documentation](https://mne.tools/stable/generated/mne.io.Raw.html#mne.io.Raw.filter)
- [raw.notch_filter() documentation](https://mne.tools/stable/generated/mne.io.Raw.html#mne.io.Raw.notch_filter)

---

## ğŸ”¬ æŠ€è¡“çš„è©³ç´°

### ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `l_freq=1.0`: ä¸‹é™å‘¨æ³¢æ•°ï¼ˆ1Hzä»¥ä¸‹ã‚’ã‚«ãƒƒãƒˆï¼‰
- `h_freq=50.0`: ä¸Šé™å‘¨æ³¢æ•°ï¼ˆ50Hzä»¥ä¸Šã‚’ã‚«ãƒƒãƒˆï¼‰
- `fir_design='firwin'`: çª“é–¢æ•°æ³•ã«ã‚ˆã‚‹FIRãƒ•ã‚£ãƒ«ã‚¿

**åŠ¹æœ**:
- DCãƒ‰ãƒªãƒ•ãƒˆé™¤å»ï¼ˆ<1Hzï¼‰
- ç­‹é›»å›³ãƒã‚¤ã‚ºé™¤å»ï¼ˆ>50Hzï¼‰
- Museã®æœ‰åŠ¹å¸¯åŸŸï¼ˆ1-50Hzï¼‰ã«é™å®š

### ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `freqs=(50, 60)`: é™¤å»ã™ã‚‹å‘¨æ³¢æ•°ãƒªã‚¹ãƒˆ

**åŠ¹æœ**:
- 50Hzé›»æºãƒã‚¤ã‚ºé™¤å»ï¼ˆæ—¥æœ¬ãƒ»ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ï¼‰
- 60Hzé›»æºãƒã‚¤ã‚ºé™¤å»ï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰
- ç‹­å¸¯åŸŸé™¤å»ï¼ˆå‘¨è¾ºå‘¨æ³¢æ•°ã¸ã®å½±éŸ¿æœ€å°ï¼‰

**å®Ÿè£…**:
- MNE-Pythonã®`raw.notch_filter()`ã‚’ä½¿ç”¨
- å†…éƒ¨ã§ãƒã‚¿ãƒ¼ãƒ¯ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### å®šé‡çš„æ”¹å–„

1. **é›»æºãƒã‚¤ã‚ºã®é™¤å»**
   - PSDã‚¹ãƒšã‚¯ãƒˆãƒ«ã§50Hz, 60Hzã®ãƒ”ãƒ¼ã‚¯ãŒæ¸›å°‘
   - SNRï¼ˆä¿¡å·å¯¾é›‘éŸ³æ¯”ï¼‰ã®å‘ä¸Š

2. **é«˜å‘¨æ³¢ãƒã‚¤ã‚ºã®å‰Šæ¸›**
   - >50Hzã®ç­‹é›»å›³ãƒã‚¤ã‚ºãŒé™¤å»
   - ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ã®é«˜å‘¨æ³¢å¸¯åŸŸãŒã‚¯ãƒªãƒ¼ãƒ³ã«

### å®šæ€§çš„æ”¹å–„

1. **è§£æã®ä¿¡é ¼æ€§å‘ä¸Š**
   - ãƒã‚¤ã‚ºã«ã‚ˆã‚‹èª¤æ¤œå‡ºã®æ¸›å°‘
   - ãƒãƒ³ãƒ‰æ¯”ç‡ã®ç²¾åº¦å‘ä¸Š

2. **ç§‘å­¦çš„å¦¥å½“æ€§**
   - æ¨™æº–çš„ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã®é©ç”¨
   - ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã® best practice ã«æº–æ‹ 

---

## ğŸ§ª æ¤œè¨¼æ–¹æ³•

### PSDã®æ¯”è¼ƒ

```python
# ãƒ•ã‚£ãƒ«ã‚¿ãªã—
mne_dict_raw = prepare_mne_raw(df, apply_bandpass=False, apply_notch=False)
psd_raw = calculate_psd(mne_dict_raw['raw'])

# ãƒ•ã‚£ãƒ«ã‚¿ã‚ã‚Š
mne_dict_filtered = prepare_mne_raw(df)  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¡æ–¹æœ‰åŠ¹
psd_filtered = calculate_psd(mne_dict_filtered['raw'])

# PSDã‚’ãƒ—ãƒ­ãƒƒãƒˆæ¯”è¼ƒ
# - 50Hz, 60Hzã®ãƒ”ãƒ¼ã‚¯ãŒæ¸›å°‘ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
# - <1Hz, >50Hzã®æˆåˆ†ãŒå‰Šæ¸›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
```

### ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ã®è¦–è¦šçš„æ¯”è¼ƒ

- é«˜å‘¨æ³¢å¸¯åŸŸï¼ˆ>50Hzï¼‰ãŒã‚¯ãƒªãƒ¼ãƒ³ã«ãªã£ã¦ã„ã‚‹ã‹
- é›»æºãƒã‚¤ã‚ºã®æ¨ªç·šï¼ˆ50Hz, 60Hzï¼‰ãŒæ¶ˆãˆã¦ã„ã‚‹ã‹

---

## âš™ï¸ ä½¿ç”¨ä¾‹

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæ¨å¥¨ï¼‰

```python
from lib import prepare_mne_raw, load_mind_monitor_csv

df = load_mind_monitor_csv('data.csv')

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒãƒ³ãƒ‰ãƒ‘ã‚¹(1-50Hz) + ãƒãƒƒãƒ(50, 60Hz)
mne_dict = prepare_mne_raw(df)
```

### ã‚«ã‚¹ã‚¿ãƒ è¨­å®š

```python
# æ—¥æœ¬ã®ã¿ï¼ˆ50Hzï¼‰
mne_dict = prepare_mne_raw(df, notch_freqs=(50,))

# ã‚¢ãƒ¡ãƒªã‚«ã®ã¿ï¼ˆ60Hzï¼‰
mne_dict = prepare_mne_raw(df, notch_freqs=(60,))

# ã‚ˆã‚Šç·©ã„å¸¯åŸŸï¼ˆ0.5-40Hzï¼‰
mne_dict = prepare_mne_raw(df, l_freq=0.5, h_freq=40.0)

# ãƒ•ã‚£ãƒ«ã‚¿ç„¡åŠ¹åŒ–ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰
mne_dict = prepare_mne_raw(df, apply_bandpass=False, apply_notch=False)
```

---

## ğŸ“ å­¦ã‚“ã ã“ã¨

### 1. ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- muse-lslã¯ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ã‚’æ¨™æº–è£…å‚™
- é›»æºãƒã‚¤ã‚ºé™¤å»ã¯è„³æ³¢è§£æã®åŸºæœ¬

### 2. MNE-Pythonã®æŸ”è»Ÿæ€§

- `raw.filter()`ã¨`raw.notch_filter()`ã®çµ„ã¿åˆã‚ã›
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã«ã‚ˆã‚Šã€æ§˜ã€…ãªçŠ¶æ³ã«å¯¾å¿œå¯èƒ½

### 3. å¾Œæ–¹äº’æ›æ€§ã®é‡è¦æ€§

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ã‚ˆã‚Šæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ç ´å£Šã—ãªã„
- æ®µéšçš„ãªæ”¹å–„ãŒå¯èƒ½

---

## ğŸ“ˆ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆPhase 2ä»¥é™ï¼‰

Phase 1ã®æˆæœã‚’è¸ã¾ãˆã€æ¬¡ã®æ”¹å–„ã¸ï¼š

1. **Phase 2: Epochãƒ™ãƒ¼ã‚¹è§£æ**
   - MNE Epochsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ´»ç”¨
   - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥çµ±è¨ˆã®æ¨™æº–åŒ–

2. **Phase 3: ICAå®Ÿé¨“**
   - ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆé™¤å»ã®é«˜åº¦åŒ–
   - 4ãƒãƒ£ãƒãƒ«ã§ã®æœ‰åŠ¹æ€§è©•ä¾¡

3. **Phase 4: å¯è¦–åŒ–å¼·åŒ–**
   - MNEæ¨™æº–ãƒ—ãƒ­ãƒƒãƒˆã®çµ±åˆ
   - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ¢ç´¢

---

## ğŸ“ æ›´æ–°å±¥æ­´

- **2025-11-11**: Phase 1å®Ÿè£…å®Œäº†
  - ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã®æ˜ç¤ºåŒ–ï¼ˆ1-50Hzï¼‰
  - ãƒãƒƒãƒãƒ•ã‚£ãƒ«ã‚¿ã®è¿½åŠ ï¼ˆ50Hz, 60Hzï¼‰
  - å¾Œæ–¹äº’æ›æ€§ã®ç¶­æŒ
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

---

**ä½œæˆè€…**: @tsu-nera
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: TBD
**æ‰¿èª**: TBD
